---
name: cocoindex-step
description: コードベースのベクトル検索の利用判断と実行手順。ヘルスチェックから検索・構築の判断フローを提供。
---

# CocoIndex 利用手順

## 概要

コードベースのベクトルインデックスを構築・検索するツール。
自然言語クエリで関連ファイルの**エントリーポイント**を発見する。

プロジェクト名・テーブル名は自動計算される。

## いつ使うか

- シンボル名もファイル名も不明で、grepキーワードすら推測できない場合
- ドメイン固有の概念（日本語含む）でコードを探したい場合
- 「〇〇の機能はあるか？」という存在確認の初手として

## いつ使わないか

- シンボル名やキーワードが推測できる場合（他のツールの方が効率的）
- 具体的なツール選択は `~/.claude/rules/tool-selection.md` を参照

## 利用判断

### 1. ヘルスチェック（PostgreSQL + インデックス確認）

```bash
bash ${CLAUDE_PLUGIN_ROOT}/scripts/check.sh
```

以下を一括確認する:
- PostgreSQL接続（停止中なら `docker compose up` を自動試行）
- 現プロジェクトのインデックステーブルの存在とチャンク数

**結果の判断**:
- 全てOK → `cocoindex-reference` スキルを参照して検索を実行する
- Index: NOT FOUND → `cocoindex-reference` スキルを参照してインデックス構築を実行する
- PostgreSQL接続NG → `cocoindex-reference` スキルを参照してセットアップを実行する

**重要**: スクリプトは `uv run` 経由で実行すること。`python3` で直接実行すると依存パッケージが見つからずエラーになる。
